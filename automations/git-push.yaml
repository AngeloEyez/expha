- id: core-git-push
  alias: "CORE|檔案變動自動同步 GitHub"
  description: "當設定檔變動後，等待 3 分鐘，若無後續變動則上傳"
  trigger:
    - platform: event
      event_type: folder_watcher
      # 不指定 event_data的event_type, 這樣所有變動都能被trigger
      #event_data:
      #  event_type: modified # 也可以加入 created 或 deleted
  condition: []
  action:
    # --- 關鍵防護：防抖 (Debounce) ---
    - delay: "00:03:00"
    # 如果在這 3 分鐘內又有變動，這個自動化會被「重新觸發」
    # 我們將執行模式設為 restart，這樣計時器就會重新計算
    - service: shell_command.git_push_auto
    - service: notify.mobile_app_your_phone
      data:
        title: "Git 自動備份成功"
        message: "最新的組態變更已成功推送到 GitHub expha 倉庫。"
  mode: restart # 重要：重啟模式，確保最後一次改動後才開始計時
